# Redis Cluster with Hash Tags Example
#
# This example demonstrates hash tag support for multi-key operations.
# Hash tags ensure related keys are stored on the same node.
#
# Note: This example shows the configuration structure.
# Hash tag key generation would need custom implementation.

[experiment]
name = "redis-cluster-hash-tags"
description = "Redis Cluster with hash tag support for multi-key operations"
duration = "60s"
seed = 42

[target]
protocol = "redis-cluster"
transport = "tcp"

# Standard 3-node cluster
[target.redis_cluster]
[[target.redis_cluster.nodes]]
address = "127.0.0.1:7000"
slot_start = 0
slot_end = 5460

[[target.redis_cluster.nodes]]
address = "127.0.0.1:7001"
slot_start = 5461
slot_end = 10921

[[target.redis_cluster.nodes]]
address = "127.0.0.1:7002"
slot_start = 10922
slot_end = 16383

[workload]
# Keys for hash tag testing
# In practice, you would use custom key generation to create
# keys like: {user:1000}.profile, {user:1000}.settings
# which would all route to the same slot
[workload.keys]
strategy = "random"
max = 100000
value_size = 256

[workload.pattern]
type = "constant"
rate = 5000.0

# MGET operations can work when keys share a hash tag
[workload.operations]
strategy = "weighted"

[[workload.operations.commands]]
name = "get"
weight = 0.5

[[workload.operations.commands]]
name = "set"
weight = 0.3

# MGET with 5 keys - works if keys share hash tag
[[workload.operations.commands]]
name = "mget"
weight = 0.2
count = 5

[[traffic_groups]]
name = "hash-tag-traffic"
threads = [0]
connections_per_thread = 15
max_pending_per_connection = 10

[traffic_groups.policy]
type = "closed-loop"

[traffic_groups.sampling_policy]
type = "limited"
rate = 1.0
max_samples = 50000

[output]
format = "json"
file = "results/redis-cluster-hash-tags.json"

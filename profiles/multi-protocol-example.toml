# Multi-Protocol Example
# Demonstrates running Redis and Memcached workloads simultaneously on the same threads

[experiment]
name = "multi-protocol-demo"
description = "Redis and Memcached running on the same worker threads"
seed = 42
duration = "30s"

[target]
transport = "tcp"


# Redis workload on threads 0-1
[[traffic_groups]]
name = "redis-load"
protocol = "redis"
target = "127.0.0.1:6379"
threads = [0, 1]
connections_per_thread = 10
max_pending_per_connection = 8

[traffic_groups.protocol_config.keys]
strategy = "zipfian"
n = 100000        # 100K key space
theta = 0.99      # High skew
value_size = 64

[traffic_groups.sampling_policy]
type = "limited"
rate = 0.1  # 10% sampling

[traffic_groups.traffic_policy]
type = "closed-loop"

# Memcached workload on the same threads 0-1
[[traffic_groups]]
name = "memcached-load"
protocol = "memcached-binary"
target = "127.0.0.1:11211"
threads = [0, 1]  # Same threads as Redis!
connections_per_thread = 10
max_pending_per_connection = 8

[traffic_groups.protocol_config.keys]
strategy = "zipfian"
n = 100000        # 100K key space
theta = 0.99      # High skew
value_size = 64

[traffic_groups.sampling_policy]
type = "limited"
rate = 0.1  # 10% sampling

[traffic_groups.traffic_policy]
type = "closed-loop"

[output]
format = "json"
file = "/tmp/multi-protocol-results.json"

# Expected behavior:
# ==================
# - Threads 0 and 1 each handle BOTH Redis and Memcached connections
# - Each thread has 20 connections total (10 Redis + 10 Memcached)
# - Stats are separated by traffic group
# - Different protocols can be benchmarked under identical conditions
